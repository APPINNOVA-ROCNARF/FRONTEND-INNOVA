<nz-table [nzOuterBordered]="true" #dynamicTable [nzData]="datos" [nzLoading]="loadingDatos" nzSize="middle"
  nzShowPagination="false" (nzCurrentPageDataChange)="onCurrentPageDataChange(datos)">
  <thead>
    <tr>
      <th nzWidth="60px" [(nzChecked)]="checked" [nzIndeterminate]="indeterminate"
        (nzCheckedChange)="onAllChecked($event)"></th>
      <th>Fecha</th>
      <th [nzFilters]="categoriasFiltro" [nzFilterFn]="filtroCategoria">
        Concepto
      </th>
      <th>Proveedor</th>
      <th>N° Factura</th>
      <th>Monto</th>
      <th [nzFilters]="estadosFiltro" [nzFilterFn]="filtroEstado">Estado</th>
      <th nzWidth="100px">Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let v of dynamicTable.data">
      <td nzShowCheckbox [nzDisabled]="v.estadoViatico === 'Aprobado'"  [nzChecked]="setOfCheckedId.has(v.id)" (nzCheckedChange)="onItemChecked(v.id, $event)"></td>
      <td>{{ v.fechaFactura | date : "medium" }}</td>
      <td>{{ v.nombreCategoria }}</td>
      <td>{{ v.nombreProveedor }}</td>
      <td>{{ v.numeroFactura }}</td>
      <td>{{ v.monto | currency : 'USD':'symbol' }}</td>
      <td>
        <nz-tag *ngIf="v.estadoViatico | estadoViatico as tag" [nzColor]="tag.color">
          {{ tag.texto }}
        </nz-tag>

      </td>
      <td style="text-align: right">
        <div style="display: flex; gap: 4px; justify-content: flex-end">
          <button nz-button nzType="link" nzSize="default" (click)="previewImagen(v.rutaImagen)" nz-tooltip
            nzTooltipTitle="Ver factura">
            <i nz-icon nzType="file-search"></i>
          </button>

          <ng-container *ngIf="!(setOfCheckedId.size > 0)">
            <a nz-dropdown [nzDropdownMenu]="menu" nzTrigger="click">
              <button nz-button nzType="link" nzSize="default" nz-tooltip nzTooltipTitle="Opciones">
                <i nz-icon nzType="ellipsis"></i>
              </button>
            </a>
          </ng-container>
        </div>

        <nz-dropdown-menu #menu="nzDropdownMenu">
          <ul nz-menu>
            <li nz-menu-item role="button" tabindex="0" (click)="aprobarViatico(v.id)" (keydown.enter)="aprobarViatico(v.id)">
              <i nz-icon nzType="edit" nzTheme="fill"></i> Editar
            </li>
            <li nz-menu-item role="button" tabindex="0" [nzDisabled]="v.estadoViatico === 'Aprobado'" (click)="aprobarViatico(v.id)" (keydown.enter)="aprobarViatico(v.id)">
              <i nz-icon nzType="check-circle"></i> Aprobar
            </li>
            <li nz-menu-item role="button" tabindex="0" nzDanger [nzDisabled]="v.estadoViatico === 'Rechazado'" (click)="rechazarViatico(v.id)" (keydown.enter)="rechazarViatico(v.id)">
              <i nz-icon nzType="close-circle"></i> Rechazar
            </li>
          </ul>
        </nz-dropdown-menu>
      </td>
    </tr>
  </tbody>
</nz-table>

<div *ngIf="mostrarBarraAcciones" class="floating-action-bar" [@slideUpFadeDown]>
  <div class="floating-action-content">
    <div class="floating-selected-info">
      <nz-badge nzStandalone [nzCount]="setOfCheckedId.size" [nzStyle]="{
          backgroundColor: '#e9f2f3',
          color: '#007f8c'
        }"></nz-badge>
      <span class="floating-selected-text">Viáticos seleccionados</span>
    </div>

    <div class="floating-actions-buttons">
      <button nz-button nzType="primary" (click)="aprobarSeleccionados()">
        <i nz-icon nzType="check-circle" nzTheme="outline"></i> Aprobar
      </button>
      <button nz-button nzType="text" nzShape="circle" (click)="limpiarSeleccion()">
        <i nz-icon nzType="close"></i>
      </button>
    </div>
  </div>
</div>