<div
  class="header-actions"
  style="
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  "
>
  <div>
    <h2 nz-typography style="margin: 0">Información FOX</h2>
    <p style="margin: 4px 0 0 0; color: #888">Placeholder</p>
  </div>
  <button nz-button nzType="primary" nzSize="large" style="margin-top: 8px">
    <i nz-icon nzType="download"></i>Formato Archivo ZIP
  </button>
</div>

<nz-divider></nz-divider>

<nz-steps [nzCurrent]="stepActual" class="espacio">
  <nz-step
    nzTitle="Cargar archivo"
    nzDescription="Seleccione el archivo a cargar."
    [nzStatus]="stepActual > 0 ? 'finish' : 'process'"
  ></nz-step>
  <nz-step
    nzTitle="Validar información"
    nzDescription="Validar que todos los archivos estén presentes"
    [nzStatus]="
      stepActual > 1 ? 'finish' : stepActual === 1 ? 'process' : 'wait'
    "
  ></nz-step>
  <nz-step
    nzTitle="Finalizado"
    nzDescription="Proceso terminado"
    [nzStatus]="getEstadoConfirmacionStep()"
  ></nz-step>
</nz-steps>

<nz-card nzSize="small" *ngIf="archivosTemp.length === 0">
  <nz-upload
    nzType="drag"
    [nzCustomRequest]="customUploadReq"
    [nzRemove]="handleRemove"
    [nzBeforeUpload]="beforeUpload"
    [nzShowUploadList]="{
      showRemoveIcon: true,
      showDownloadIcon: false
    }"
    [nzFileList]="uploadList"
    (nzChange)="handleChange($event)"
  >
    <p class="ant-upload-drag-icon">
      <nz-icon nzType="cloud-sync" />
    </p>
    <p class="ant-upload-text">
      Haz click o arrastra el archivo .zip aquí para iniciar
    </p>
    <p class="ant-upload-hint">Formato soportado: ZIP (.zip)</p>
  </nz-upload>
</nz-card>

<div *ngIf="archivosTemp.length > 0" class="file-list-container">
  <h4 class="section-title">Archivos extraídos:</h4>

  <div class="virtual-scroll-container">
    <cdk-virtual-scroll-viewport
      itemSize="100"
      class="file-viewport"
      [style.height.px]="getViewportHeight()"
    >
      <div *cdkVirtualFor="let archivo of archivosTemp" class="file-item">
        <div class="file-icon">
          <i nz-icon nzType="file-text"></i>
        </div>
        <div class="file-info" style="flex: 1">
          <div class="file-name">{{ archivo.nombreOriginal }}</div>
          <div class="file-size">{{ archivo.size | fileSize }}</div>
          <div class="file-result" *ngIf="archivo.registrosInsertados !== 0">
            <span style="font-size: 13px; color: #555">
              {{ archivo.registrosInsertados }} registros insertados
            </span>
          </div>
          <nz-progress
            [nzPercent]="archivo.progress || 0"
            [nzStatus]="archivo.status || 'normal'"
            nzSize="small"
            style="margin-top: 4px"
          ></nz-progress>
        </div>
        <div class="file-actions">
          <button
            nz-button
            nzType="text"
            nzSize="small"
            [disabled]="procesando"
            (click)="handleRemoveByNombre(archivo.nombreOriginal)"
          >
            <i nz-icon nzType="delete"></i>
          </button>
        </div>
      </div>
    </cdk-virtual-scroll-viewport>

    <div class="action-buttons" style="margin-top: 16px" *ngIf="stepActual !== 3">
      <button
        nz-button
        nzSize="large"
        nzType="default"
        (click)="cancelarCarga()"
      >
        Cancelar
      </button>
      <button
        nz-button
        nzSize="large"
        nzType="primary"
        [disabled]="procesando"
        style="margin-left: 8px"
        (click)="confirmarCarga()"
      >
        Confirmar
      </button>
    </div>
  </div>
</div>
